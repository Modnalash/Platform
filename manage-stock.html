<!-- Example: manage-stock.html with Supabase connected -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Stock</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = "https://rwmwsaxlqblvnhfyuuqg.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ3bXdzYXhscWJsdm5oZnl1dXFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NDU3OTYsImV4cCI6MjA2NTQyMTc5Nn0.gwcRLpJzsHkSVLQs0iFULIk6eAc7FlHHF9LaERlQJ6Y";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>
</head>
<body>
  <div class="sidebar">
    <h2>MODNA Admin</h2>
    <a href="dashboard-admin.html">Dashboard</a>
    <a href="manage-stock.html" class="active">Manage Stock</a>
    <a href="order-history.html">Order History</a>
    <a href="#">Report</a>
    <a href="index.html">Logout</a>
  </div>

  <div class="main-content">
    <h1>Manage Stock</h1>
    <button onclick="exportStock()">üì• Export Stock</button>
    <table id="stockTable">
      <thead>
        <tr>
          <th>Product</th>
          <th>Category</th>
          <th>Quantity</th>
          <th class="actions">Actions</th>
        </tr>
      </thead>
      <tbody id="stockBody">
        <!-- Fetched products will appear here -->
      </tbody>
    </table>

    <div class="add-form">
      <h3>Add New Product</h3>
      <input type="text" id="productName" placeholder="Product Name" />
      <select id="productCategory">
        <option value="">-- Select Category --</option>
        <option value="Lashes">Lashes</option>
        <option value="Accessories">Accessories</option>
        <option value="Make-up">Make-up</option>
      </select>
      <input type="number" id="productQty" placeholder="Quantity" />
      <button onclick="addProduct()">Add Product</button>
    </div>
  </div>

  <script>
    async function fetchStock() {
      const { data, error } = await supabase.from("stock").select();
      const tbody = document.getElementById("stockBody");
      tbody.innerHTML = "";
      data.forEach((item) => {
        tbody.innerHTML += `
          <tr>
            <td>${item.name}</td>
            <td>${item.category}</td>
            <td>${item.qty}</td>
            <td class="actions">
              <button onclick="editProduct(${item.id})">‚úèÔ∏è Edit</button>
              <button onclick="deleteProduct(${item.id})">üóëÔ∏è Delete</button>
            </td>
          </tr>
        `;
      });
    }

    async function addProduct() {
      const name = document.getElementById("productName").value.trim();
      const category = document.getElementById("productCategory").value.trim();
      const qty = parseInt(document.getElementById("productQty").value);
      if (!name || !category || isNaN(qty)) return alert("Fill all fields");
      const { error } = await supabase.from("stock").insert([{ name, category, qty }]);
      if (error) return alert("Error adding product");
      fetchStock();
      document.getElementById("productName").value = "";
      document.getElementById("productCategory").value = "";
      document.getElementById("productQty").value = "";
    }

    async function deleteProduct(id) {
      if (!confirm("Delete this product?")) return;
      await supabase.from("stock").delete().eq("id", id);
      fetchStock();
    }

    function exportStock() {
      const rows = document.querySelectorAll("#stockTable tr");
      let csv = [];
      for (const row of rows) {
        const cells = Array.from(row.children).map(cell => cell.innerText);
        csv.push(cells.join(","));
      }
      const blob = new Blob([csv.join("\n")], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "modna_stock.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    fetchStock();
  </script>
</body>
</html>
