<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MODNA Admin - Manage Stock</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <div class="flex">
    <!-- Sidebar -->
    <div class="w-64 bg-blue-900 text-white p-6 min-h-screen">
      <h2 class="text-3xl font-bold mb-8">MODNA Admin</h2>
      <nav class="space-y-4">
        <a href="dashboard-admin.html" class="block bg-blue-800 p-2 rounded">Dashboard</a>
        <a href="manage-stock.html" class="block bg-blue-700 p-2 rounded">Manage Stock</a>
        <a href="order-history.html" class="block hover:bg-blue-800 p-2 rounded">Order History</a>
        <a href="report.html" class="block hover:bg-blue-800 p-2 rounded">Report</a>
        <a href="login.html" class="block hover:bg-red-600 p-2 rounded">Logout</a>
      </nav>
    </div>

    <!-- Main content -->
    <div class="flex-1 p-8">
      <h1 class="text-4xl font-bold mb-6">Manage Stock</h1>
      <button onclick="exportStock()" class="mb-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded flex items-center">
        ðŸ“„ Export Stock
      </button>

      <!-- Stock Table -->
      <div class="overflow-x-auto">
        <table class="w-full text-left rounded bg-gray-800">
          <thead>
            <tr class="bg-blue-800 text-white">
              <th class="p-3">Product</th>
              <th class="p-3">Category</th>
              <th class="p-3">Quantity</th>
              <th class="p-3">Actions</th>
            </tr>
          </thead>
          <tbody id="stock-table-body">
            <!-- JS Injected Rows -->
          </tbody>
        </table>
      </div>

      <!-- Add Product Form -->
      <div class="mt-10 bg-gray-800 p-6 rounded">
        <h2 class="text-2xl font-semibold mb-4">Add New Product</h2>
        <div class="flex space-x-4">
          <input type="text" id="product-name" placeholder="Product Name" class="p-2 rounded w-1/3 text-black" />
          <select id="product-category" class="p-2 rounded w-1/3 text-black">
            <option value="">-- Select Category --</option>
            <option value="Lashes">Lashes</option>
            <option value="Adhesives">Adhesives</option>
            <option value="Accessories">Accessories</option>
          </select>
          <input type="number" id="product-qty" placeholder="Quantity" class="p-2 rounded w-1/4 text-black" />
          <button onclick="addProduct()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Add Product</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://rwmwsaxlqblvnhfyuuqg.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ3bXdzYXhscWJsdm5oZnl1dXFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NDU3OTYsImV4cCI6MjA2NTQyMTc5Nn0.gwcRLpJzsHkSVLQs0iFULIk6eAc7FlHHF9LaERlQJ6Y';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function loadStock() {
      const { data, error } = await supabase.from('stock').select('*');
      const tableBody = document.getElementById('stock-table-body');
      tableBody.innerHTML = '';
      if (data) {
        data.forEach(item => {
          const row = `<tr class="border-t border-gray-700">
            <td class="p-3">${item.name}</td>
            <td class="p-3">${item.category}</td>
            <td class="p-3">${item.qty}</td>
            <td class="p-3">
              <button onclick="deleteProduct(${item.id})" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded">Delete</button>
            </td>
          </tr>`;
          tableBody.insertAdjacentHTML('beforeend', row);
        });
      }
    }

    async function addProduct() {
      const name = document.getElementById('product-name').value.trim();
      const category = document.getElementById('product-category').value;
      const qty = parseInt(document.getElementById('product-qty').value);
      if (!name || !category || isNaN(qty)) return alert('All fields are required.');
      const { error } = await supabase.from('stock').insert([{ name, category, qty }]);
      if (!error) {
        loadStock();
        document.getElementById('product-name').value = '';
        document.getElementById('product-category').value = '';
        document.getElementById('product-qty').value = '';
      } else {
        alert('Error adding product.');
      }
    }

    async function deleteProduct(id) {
      const { error } = await supabase.from('stock').delete().eq('id', id);
      if (!error) loadStock();
    }

    function exportStock() {
      alert('Export logic coming soon.');
    }

    loadStock();
  </script>
</body>
</html>
